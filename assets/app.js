function AppCtrl(e,t,r,n){this.$=t,this._=r,this.$(e).on("resize orientationchange",this._.debounce(function(){n.trigger("resize")},250))}function TreeMapCtrl(e,t,r,n,i,a,s,o){this.$=r,this.$q=t,this.d3=n,this.HEX=a,this.$element=this.$(e),this.$d3Element=this.$element.find(".treeMap svg"),this.settings=o,this._visibleDepth=1,this.currentLevel=0,this.treeMap.width=this.$d3Element.width(),this.treeMap.height=this.$d3Element.height(),this.numColors=10,this.steps=6,this.treeMap.colors=new s(this.d3.scale.category10().domain(n.range(this.numColors)).range()).getScaledFadedColors(this.steps),this.treeMap.x=this.d3.scale.linear().domain([0,this.treeMap.width]).range([0,this.treeMap.width]),this.treeMap.y=this.d3.scale.linear().domain([0,this.treeMap.height]).range([0,this.treeMap.height]),this.treeMap.el=this.d3.layout.treemap().children(function(e,t){return t?null:e._children}).sort(function(e,t){return e.value-t.value}).ratio(this.treeMap.height/this.treeMap.width*.5*(1+Math.sqrt(5))).round(!1).ratio(1),this.treeMap.element=this.d3.select(this.$d3Element[0]).attr("viewBox","0 0 "+this.treeMap.width+" "+this.treeMap.height).append("g").style("shape-rendering","crispEdges"),this.treeMap.$element=this.$(this.treeMap.element.node()),this.treeMap.grandParent=this.d3.select("#back"),this.treeMap.$grandParent=this.$(this.treeMap.grandParent.node()),this.treeMap.$grandParentContainer=this.treeMap.$grandParent.parent(),this.d3.json("data/cl.json",function(e,t){return e?console.warn(e):(this.data=t,void this.draw())}.bind(this))}function treeMapDirective(){"use strict";return{controller:"TreeMapCtrl",controllerAs:"treeMap",restrict:"E",replace:!0,templateUrl:"treeMap/template.html"}}function TreeMapDivCtrl(e,t,r,n,i,a){this.$window=e,this.$=r,this.d3=n,this.$element=this.$(t),this.$d3Element=this.$element.find(".treeMap"),this.currentDepth=0,this._visibleDepth=3,this.treeMap.width=this.$d3Element.width(),this.treeMap.height=this.$d3Element.height(),this.numColors=10,this.steps=6,this.treeMap.colors=new a(this.d3.scale.category10().domain(n.range(this.numColors)).range()).getScaledFadedColors(this.steps),this.treeMap.x=this.d3.scale.linear().domain([0,this.treeMap.width]).range([0,this.treeMap.width]),this.treeMap.y=this.d3.scale.linear().domain([0,this.treeMap.height]).range([0,this.treeMap.height]),this.treeMap.el=this.d3.layout.treemap().children(function(e,t){return t?null:e._children}).sort(function(e,t){return e.value-t.value}).ratio(this.treeMap.height/this.treeMap.width*.5*(1+Math.sqrt(5))).round(!1),this.treeMap.element=this.d3.select(this.$d3Element[0]).append("div").classed("wrapper",!0),this.treeMap.$element=r(this.treeMap.element[0]),this.treeMap.grandparent=this.d3.select("#back"),i.d3.then(function(e){this.data=e,this.draw()}.bind(this))}function treeMapDivDirective(){"use strict";return{controller:"TreeMapDivCtrl",controllerAs:"treeMap",restrict:"E",replace:!0,templateUrl:"treeMapDiv/template.html"}}function Neo4J(e,t){return function(r,n,i){return e(r+"/db/data/transaction/commit/",{},{query:{method:"POST",headers:{Accept:"application/json; charset=UTF-8","Content-type":"application/json",Authorization:"Basic: "+t.btoa(n+":"+i)},isArray:!1}})}}function buildTree(e){var t,r,n,i,a,s,o,l,h={"owl:Thing":{}},p=e.data,d={"owl:Thing":{name:"owl:Thing",children:[]}};for(o=e.columns.length,s=0;o>s;s++)switch(e.columns[s]){case"child":t=s;break;case"dataSet":a=s;break;case"parent":l=s}for(o=p.length,s=0;o>s;s++)r=p[s].row[t],n=p[s].row[a],i=p[s].row[l],i.name in d||(d[i.name]={children:[],dataSets:[],name:i.name,numDataSets:0,ontID:i.name}),r.name in d||(d[r.name]={children:[],dataSets:[],name:r.name,numDataSets:0,ontID:r.name}),"rdfs:label"in r&&(d[r.name].name=r["rdfs:label"]),"uri"in r&&(d[r.name].uri=r.uri),null!==n&&(d[r.name].numDataSets++,d[r.name].dataSets.push(n.uuid)),i.name in h||(h[i.name]={}),r.name in h[i.name]||(d[i.name].children.push(d[r.name]),h[i.name][r.name]=!0);return JSON.parse(JSON.stringify(d["owl:Thing"]))}function Neo4jD3(e,t,r){this.$q=e,this.Neo4J=new t(r.neo4jUrl,r.neo4jUser,r.neo4jPassword)}angular.module("treeMapApp",["templates","treeMap","treeMapDiv","globalEvents"]),angular.module("treeMap",["neo4jD3","d3Colors"]),angular.module("treeMapDiv",["neo4jD3","d3Colors"]),angular.module("color",[]),angular.module("globalEvents",[]),angular.module("neo4jD3",["ngResource"]),angular.module("treeMapApp").config([function(){}]),angular.module("treeMapApp").controller("AppCtrl",["$window","$","_","globalEvents",AppCtrl]),angular.module("treeMapApp").constant("$",jQuery).constant("_",_.noConflict()).constant("d3",d3),angular.module("treeMapApp").constant("settings",{neo4jUrl:"http://localhost:7474",neo4jUser:"neo4j",neo4jPassword:"123",treeMapFadeInDuration:333,treeMapZoomDuration:666}),TreeMapCtrl.prototype.accumulateAndPrune=function(e,t){function r(e,t,n,i){e._children=e.children,e.meta.originalDepth=i;for(var a=t;a--;){var s=e.children[a],o=s.children?s.children.length:!1;if(s.meta=s.meta||{},o&&(r.call(this,s,o,n,i+1),o=s.children.length),o){if(s[n])s.value+=s[n],s.children.push({name:s.name,meta:{originalDepth:s.depth+1,pseudoNode:!0},value:s[n]}),s.children[s.children.length-1][n]=s[n];else if(1===t||1===o){for(var l=0,h=s.children.length;h>l;l++)s.children[l].meta.skipped?s.children[l].meta.skipped.unshift(s.name):s.children[l].meta.skipped=[s.name],e.children.push(s.children[l]);e.children.splice(a,1)}}else{if(!s[n]){e.children.splice(a,1),t--;continue}s.value=s[n],s.meta.leaf=!0,s.meta.originalDepth=i+1}"undefined"!=typeof e.value?e.value+=s.value:e.value=s.value}}var n=e.children?e.children.length:!1;e.meta=e.meta||{},n&&(r.call(this,e,n,t,0),e.value?e.value+=e[t]:e.value=e[t])},TreeMapCtrl.prototype.addChildren=function(e,t,r,n){var i,a=this,s=[],o=e.selectAll(".group-of-nodes").data(t._children).enter().append("g").attr("class","group-of-nodes");r<this.visibleDepth?(this.children[r+1]=this.children[r+1]||[],o.each(function(e){if(e._children&&e._children.length){var t=a.addChildren(a.d3.select(this),e,r+1,n);a.children[r+1].push(t[0]),s.push(t[1])}})):i=this.addInnerNodes(o);var l=o.filter(function(e){return!(e._children&&e._children.length)}),h=l.selectAll(".leaf-node").data(function(e){return[e]}).enter().append("g").attr("class","leaf-node").attr("opacity",0);h.append("rect").attr("class","leaf").attr("fill",this.color.bind(this)).call(this.rect.bind(this)),h.call(this.addLabel.bind(this),"name");var p=h;return h.length||(p=l),i&&i.length&&(p[0]=p[0].concat(i[0])),s=s.concat(this.fadeIn(p,n)),[o,this.$q.all(s)]},TreeMapCtrl.prototype.addEventListeners=function(){var e=this;this.treeMap.$grandParent.on("click","a",function(){e.transition(this,this.__data__)}),this.treeMap.$element.on("click",".label-wrapper, .outer-border",function(){var t=$(this);"leaf-node"!==t.parent().attr("class")&&e.transition(this,this.__data__)}),this.treeMap.$element.on("mousewheel",function(e){e.preventDefault(),this.visibleDepth+=e.deltaY>0?1:-1}.bind(this))},TreeMapCtrl.prototype.addInnerNodes=function(e){var t=e.filter(function(e){return e._children&&e._children.length});return innerNodes=t.append("g").attr("class","inner-node").attr("opacity",0),innerNodes.append("rect").attr("class","inner-border").attr("fill",this.color.bind(this)).call(this.rect.bind(this),1),innerNodes.append("rect").attr("class","outer-border").call(this.rect.bind(this)),innerNodes.call(this.addLabel.bind(this),"name"),innerNodes},TreeMapCtrl.prototype.addLabel=function(e,t){var r=this;e.append("foreignObject").attr("class","label-wrapper").call(this.rect.bind(this),2).append("xhtml:div").attr("class","label").attr("title",function(e){return e[t]}).classed("label-bright",function(e){if(e.meta.colorRgb){var t=e.meta.colorRgb.contrast(new r.HEX("#000000").toRgb()),n=e.meta.colorRgb.contrast(new r.HEX("#ffffff").toRgb());return n>t}}).append("xhtml:span").text(function(e){return e[t]})},TreeMapCtrl.prototype.addLevelsOfNodes=function(e){var t=this.d3.selectAll(".inner-node"),r=[],n=this;this.children[e+1]=this.children[e+1]||[];for(var i=0,a=this.children[e].length;a>i;i++)this.children[e][i].each(function(t){if(t._children&&t._children.length){var i=n.addChildren(n.d3.select(this),t,e+1);n.children[e+1].push(i[0]),r.push(i[1])}});this.$q.all(r).then(function(){t.remove()})},TreeMapCtrl.prototype.adjustLevelDepth=function(e){e<this.visibleDepth&&this.addLevelsOfNodes(e),e>this.visibleDepth&&this.removeLevelsOfNodes(e)},TreeMapCtrl.prototype.color=function(e){var t,r;return e.meta.colorHex?e.meta.colorHex:(t=this.treeMap.colors("depth"===this.colorMode?e.meta.branchNo[0]*this.steps+Math.min(this.steps,e.meta.originalDepth)-1:e.meta.branchNo[0]*this.steps+Math.max(0,this.steps-e.meta.revDepth-1)),r=new this.HEX(t).toRgb(),e.meta.colorHex=t,e.meta.colorRgb=r,t)},TreeMapCtrl.prototype.colorEl=function(e,t){e.attr(t,this.color.bind(this))},TreeMapCtrl.prototype.display=function(e,t){this.setBreadCrumb(e),this.treeMap.formerGroupWrapper=this.treeMap.groupWrapper,this.treeMap.groupWrapper=this.treeMap.element.append("g").datum(e).attr("class","depth"),this.children[0]=[this.treeMap.groupWrapper];var r=this.addChildren(this.treeMap.groupWrapper,e,1,t);return this.children[1]=[r[0]],r},TreeMapCtrl.prototype.draw=function(){return null===this.data?!1:(this.initialize(this.data),this.accumulateAndPrune(this.data,"numDataSets"),this.layout(this.data,0),this.display(this.data,!0),void this.addEventListeners())},TreeMapCtrl.prototype.fadeIn=function(e,t){var r=[],n=[],i=this;return e.each(function(e,t){r[t]=i.$q.defer(),n[t]=r[t].promise}),e.transition().duration(function(){return t?i.settings.treeMapFadeInDuration+Math.random()*i.settings.treeMapFadeInDuration:i.settings.treeMapFadeInDuration}).delay(function(){return t?Math.random()*i.settings.treeMapFadeInDuration:0}).attr("opacity",1).each("end",function(e,t){r[t].resolve()}),n},TreeMapCtrl.prototype.initialize=function(e){e.x=e.y=0,e.dx=this.treeMap.width,e.dy=this.treeMap.height,e.depth=0,e.meta={branchNo:[]}},TreeMapCtrl.prototype.layout=function(e,t){if(e.cache={},e.meta.depth=t,e._children&&e._children.length){this.depth=Math.max(this.depth,t+1),this.treeMap.el({_children:e._children});for(var r=0,n=e._children.length;n>r;r++){var i=e._children[r];i.x=e.x+i.x*e.dx,i.y=e.y+i.y*e.dy,i.dx*=e.dx,i.dy*=e.dy,i.parent=e,i.meta.branchNo=e.meta.branchNo.concat([r]),this.layout(i,t+1),e.meta.revDepth=Math.max(i.meta.revDepth+1,e.meta.revDepth||0)}}else e.meta.revDepth=0},TreeMapCtrl.prototype.rect=function(e,t){var r=this;t=t||0,e.attr("x",function(e){return r.treeMap.x(e.x)+t}).attr("y",function(e){return r.treeMap.y(e.y)+t}).attr("width",function(e){return e.cache.width=Math.max(0,r.treeMap.x(e.x+e.dx)-r.treeMap.x(e.x)-2*t),e.cache.width}).attr("height",function(e){return e.cache.height=Math.max(0,r.treeMap.y(e.y+e.dy)-r.treeMap.y(e.y)-2*t),e.cache.height})},TreeMapCtrl.prototype.removeLevelsOfNodes=function(e){var t,r,n=(this.currentLevel+this.visibleDepth,this);for(t=0,r=this.children[this.visibleDepth].length;r>t;t++)this.children[this.visibleDepth][t].each(function(e){n.fadeIn(n.addInnerNodes(n.d3.select(this)))});for(t=0,r=this.children[this.visibleDepth+1].length;r>t;t++){var i=this.children[this.visibleDepth+1][t].transition().duration(250);i.style("opacity",0).remove()}for(t=this.visibleDepth+1;e>=t;t++)this.children[t]=void 0},TreeMapCtrl.prototype.setBreadCrumb=function(e){this.treeMap.grandParent.selectAll("li").remove(),this.treeMap.$grandParent.removeClass("right").removeAttr("style"),this.treeMap.breadCrumbWidth=0,this.treeMap.breadCrumbContainerWidth=this.treeMap.breadCrumbContainerWidth||this.treeMap.$grandParentContainer.width();var t=($(this.treeMap.grandParent[0]),e.parent),r=this.treeMap.grandParent.append("li").attr("class","current-root");for(t&&r.append("svg").attr("class","icon-arrow-left is-mirrored").append("use").attr("xlink:href","assets/images/icons.svg#arrow-left"),r.append("span").attr("class","text").text(e.name),this.treeMap.breadCrumbWidth+=$(r.node()).width();t;){var n=this.treeMap.grandParent.insert("li",":first-child").append("a").datum(t);if(t.parent&&n.append("svg").attr("class","icon-arrow-left is-mirrored").append("use").attr("xlink:href","assets/images/icons.svg#arrow-left"),n.append("span").attr("class","text").text(t.name),this.treeMap.breadCrumbWidth+=$(n.node()).outerWidth(),this.treeMap.breadCrumbWidth>this.treeMap.breadCrumbContainerWidth){this.treeMap.$grandParent.addClass("right").css("marginLeft",-this.treeMap.breadCrumbWidth),$(n.node()).parent().html("&hellip;");break}e=t,t=e.parent}},TreeMapCtrl.prototype.transition=function(e,t){if(!this.treeMap.transitioning&&t){this.currentLevel=t.meta.depth,this.treeMap.transitioning=!0;var r,n,i,a=this.display.call(this,t);a[1].then(function(){a=a[0],r=r=a.transition().duration(this.settings.treeMapZoomDuration),n=this.treeMap.formerGroupWrapper,i=n.transition().duration(this.settings.treeMapZoomDuration),this.treeMap.x.domain([t.x,t.x+t.dx]),this.treeMap.y.domain([t.y,t.y+t.dy]),this.treeMap.element.style("shape-rendering",null),a.selectAll(".label-wrapper").style("fill-opacity",0),i.selectAll(".inner-border").call(this.rect.bind(this),1),i.selectAll(".outer-border, .leaf").call(this.rect.bind(this)),i.selectAll(".label-wrapper").call(this.rect.bind(this),2),r.selectAll(".inner-border").call(this.rect.bind(this),1),r.selectAll(".outer-border, .leaf").call(this.rect.bind(this)),r.selectAll(".label-wrapper").style("fill-opacity",1).call(this.rect.bind(this),2),i.remove().each("end",function(){this.treeMap.element.style("shape-rendering","crispEdges"),this.treeMap.transitioning=!1}.bind(this))}.bind(this))["catch"](function(e){console.error(e)})}},Object.defineProperty(TreeMapCtrl.prototype,"children",{configurable:!1,enumerable:!0,value:[],writable:!0}),Object.defineProperty(TreeMapCtrl.prototype,"data",{configurable:!1,enumerable:!0,value:{},writable:!0}),Object.defineProperty(TreeMapCtrl.prototype,"depth",{configurable:!1,enumerable:!0,value:0,writable:!0}),Object.defineProperty(TreeMapCtrl.prototype,"visibleDepth",{configurable:!1,enumerable:!0,get:function(){return this._visibleDepth},set:function(e){var t=this._visibleDepth;this._visibleDepth=Math.min(Math.max(1,e),this.depth),this.adjustLevelDepth(t)}}),Object.defineProperty(TreeMapCtrl.prototype,"treeMap",{configurable:!1,enumerable:!0,value:{},writable:!0}),angular.module("treeMap").controller("TreeMapCtrl",["$element","$q","$","d3","neo4jD3","HEX","D3Colors","settings",TreeMapCtrl]),angular.module("treeMap").directive("treeMap",[treeMapDirective]),TreeMapDivCtrl.prototype.accumulateAndPrune=function(e,t){function r(e,t,n,i){e._children=e.children,e.meta.originalDepth=i;for(var a=t;a--;){var s=e.children[a],o=s.children?s.children.length:!1;if(s.meta=s.meta||{},o&&(r.call(this,s,o,n,i+1),o=s.children.length),o){if(s[n])s.value+=s[n],s.children.push({name:s.name,meta:{originalDepth:s.depth+1,pseudoNode:!0},value:s[n]}),s.children[s.children.length-1][n]=s[n];else if(1===t||1===o){for(var l=0,h=s.children.length;h>l;l++)s.children[l].meta.skipped?s.children[l].meta.skipped.unshift(s.name):s.children[l].meta.skipped=[s.name],e.children.push(s.children[l]);e.children.splice(a,1)}}else{if(!s[n]){e.children.splice(a,1),t--;continue}s.value=s[n],s.meta.leaf=!0,s.meta.originalDepth=i+1}"undefined"!=typeof e.value?e.value+=s.value:e.value=s.value}}var n=e.children?e.children.length:!1;e.meta=e.meta||{},n&&(r.call(this,e,n,t,0),e.value?e.value+=e[t]:e.value=e[t])},TreeMapDivCtrl.prototype.addChildren=function(e,t,r,n){var i=this,a=e.selectAll("div").data(t._children).enter().append("div").attr("class",function(e){var t="node";return e._children&&e._children.length?t+=" inner-node":(t+=" leaf",e.visibility=!0),r==this.visibleDepth&&(t+=" last",e.visibility=!0),r>this.visibleDepth&&(t+=" hidden"),t}.bind(this)).attr("title",function(e){return e.uri}).style("background-color",function(e){return e.visibility?this.color(e):void 0}.bind(this)).call(i.coordinates.bind(i));return a.append("span").attr("class",function(e){var t="name";return e.meta.aspectRatio<1&&(t+=" rotated"),t}).text(function(e){return e.name}),this.nodesAtLevel[r+1]=this.nodesAtLevel[r+1]||[],a.each(function(e){if(n&&e.visibility){var t=$(this);t.css({opacity:0,transform:"scale(0.9)"}),i.$window.requestNextAnimationFrame(function(){t.css("transitionDuration",function(){return(500+parseInt(750*Math.random()))/1e3+"s"}).css("transitionDelay",function(){return parseInt(500*Math.random())/1e3+"s"}).css({opacity:1,transform:"scale(1)"})})}e._children&&e._children.length&&i.nodesAtLevel[r+1].push(i.addChildren(i.d3.select(this),e,r+1,n))}),a},TreeMapDivCtrl.prototype.addClickListener=function(){var e=this;$(this.treeMap.element[0]).on("click",".inner-node.last",function(t){e.transition(this,this.__data__)})},TreeMapDivCtrl.prototype.adjustLevelDepth=function(e,t){if(e!==t){var r,n,i,a;for(t>e?(r=e-1,n=t):(a=!0,r=t-1,n=e),i=0,len=this.nodesAtLevel[t].length;i<len;i++)this.nodesAtLevel[t][i].classed("last",!0).classed("hidden",!1);for(i=0,len=this.nodesAtLevel[e].length;i<len;i++)this.nodesAtLevel[e][i].classed("last",!1).classed("hidden",!0);for(;r++<n;)for(i=0,len=this.nodesAtLevel[r].length;i<len;i++)this.nodesAtLevel[r][i].style("background-color",function(e){return r===t||0===e.meta.revDepth?this.color(e):void 0}.bind(this)).classed("last",function(e){return r===t?!0:void 0}).classed("hidden",function(e){return a&&r===t?!1:a})}},TreeMapDivCtrl.prototype.browseMode=function(e){this.mode=e},TreeMapDivCtrl.prototype.color=function(e){return this.treeMap.colors("depth"===this.colorMode?e.meta.branchNo[0]*this.steps+Math.min(this.steps,e.meta.originalDepth)-1:e.meta.branchNo[0]*this.steps+Math.max(0,this.steps-e.meta.revDepth-1))},TreeMapDivCtrl.prototype.colorEl=function(e,t){e.attr(t,this.color.bind(this))},TreeMapDivCtrl.prototype.display=function(e,t){var r=this;this.treeMap.grandparent.datum(e.parent).on("click",function(e){r.transition.call(r,this,e)}).text(this.name(e)),this.treeMap.element.datum(e),this.nodesAtLevel[0]=[this.treeMap.element];var n=this.addChildren.call(this,this.treeMap.element,e,1,t);return this.nodesAtLevel[1]=[n],n},TreeMapDivCtrl.prototype.draw=function(){return null===this.data?!1:(console.log("vdepth "+this.visibleDepth),this.initialize(this.data),this.accumulateAndPrune(this.data,"numDataSets"),this.layout(this.data,0),this.display(this.data,!0),void this.addClickListener())},TreeMapDivCtrl.prototype.initialize=function(e){e.x=e.y=0,e.dx=this.treeMap.width,e.dy=this.treeMap.height,e.depth=0,e.meta={branchNo:[]}},TreeMapDivCtrl.prototype.layout=function(e,t){if(e.meta.depth=t,e._children&&e._children.length){this.treeMap.depth=Math.max(this.treeMap.depth,t+1),this.treeMap.el({_children:e._children});for(var r=0,n=e._children.length;n>r;r++){var i=e._children[r];i.x=i.x*e.dx,i.y=i.y*e.dy,i.dx*=e.dx,i.dy*=e.dy,i.parent=e,i.meta.aspectRatio=i.dx/i.dy,i.meta.area=i.dy*i.dx,i.meta.branchNo=e.meta.branchNo.concat([r]),this.layout(i,t+1),e.meta.revDepth=Math.max(i.meta.revDepth+1,e.meta.revDepth||0)}}else e.meta.revDepth=0},TreeMapDivCtrl.prototype.name=function(e){return e.parent?this.name(e.parent)+"."+e.name:e.name},TreeMapDivCtrl.prototype.coordinates=function(e){var t=this;e.style("left",function(e){return t.treeMap.x(e.x)+"px"}).style("top",function(e){return t.treeMap.y(e.y)+"px"}).style("width",function(e){return t.treeMap.x(e.x+e.dx)-t.treeMap.x(e.x)+"px"}).style("height",function(e){return t.treeMap.y(e.y+e.dy)-t.treeMap.y(e.y)+"px"})},TreeMapDivCtrl.prototype.transition=function(e,t){if(!this.treeMap.transitioning&&t){this.treeMap.transitioning=!0;for(var r=0,n=0,i=t;i.meta.depth>this.currentDepth;)r+=i.x,n+=i.y,i=i.parent;{this.treeMap.element.transition().duration(750)}this.treeMap.x.domain([0,t.dx]),this.treeMap.y.domain([0,t.dy]);var a=this.treeMap.width/t.dx,s=this.treeMap.height/t.dy,o=r+t.dx/2,l=n+t.dy/2,h=this.treeMap.width/2-o,p=this.treeMap.height/2-l;console.log("transform-origin: "+(r+t.dx/2)+"px "+(n+t.dy/2)+"px","scaleX("+a+") scaleY("+s+")",h,p,"translate3d(-"+r+"px, -"+n+"px)"),this.treeMap.$element.css("transform","translate3d(-"+r*a+"px, -"+n*s+"px, 0)"),this.treeMap.element.selectAll(".node").style("transition-delay",null).style("transition-duration",null).style("transform","rotate(0.1deg)").call(this.coordinates.bind(this))}},Object.defineProperty(TreeMapDivCtrl.prototype,"nodesAtLevel",{configurable:!1,enumerable:!0,value:[],writable:!0}),Object.defineProperty(TreeMapDivCtrl.prototype,"data",{configurable:!1,enumerable:!0,value:null,writable:!0}),Object.defineProperty(TreeMapDivCtrl.prototype,"mode",{configurable:!1,enumerable:!0,value:"branch",writable:!0}),Object.defineProperty(TreeMapDivCtrl.prototype,"visibleDepth",{configurable:!1,enumerable:!0,get:function(){return this._visibleDepth},set:function(e){var t=this._visibleDepth;this._visibleDepth=Math.max(1,e),this.adjustLevelDepth(t,this.visibleDepth)}}),Object.defineProperty(TreeMapDivCtrl.prototype,"treeMap",{configurable:!1,enumerable:!0,value:{},writable:!0}),angular.module("treeMapDiv").controller("TreeMapDivCtrl",["$window","$element","$","d3","neo4jD3","D3Colors",TreeMapDivCtrl]),angular.module("treeMapDiv").directive("treeMapDiv",[treeMapDivDirective]),angular.module("color").factory("HEX",["$injector",function(e){function t(e){this.hex=e}return t.prototype.constructor=t,t.prototype.toHsl=function(){return this.toRgb().toHsl()},t.prototype.toRgb=function(){var t=e.get("RGB"),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(this.hex);return new t(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))},t.prototype.toString=function(){return"#"+this.hex},Object.defineProperty(t.prototype,"hex",{get:function(){return this._hex},set:function(e){if("string"!=typeof e)throw new Error("HEX must be a string. "+typeof e);var t=e.match(/^#?((?:[0-9a-fA-F]{3}){1,2})$/i);if(!t)throw new Error('String "'+e+'" is not a valid HEX color.');e=t[1],this._hex=e}}),t}]),angular.module("color").factory("HSL",["$injector",function(e){function t(e,t,r){"object"==typeof e?(this.lightness=e.lightness,this.saturation=e.saturation,this.hue=e.hue):(this.hue=e,this.lightness=r,this.saturation=t)}return t.prototype.constructor=t,t.prototype.brighten=function(e,r){for(var n=[],i=0,a=(1-this.lightness)/(e+(r?1:0));i++<e;)n.push(new t(this.hue,this.saturation,this.lightness+i*a));return n},t.prototype.toHex=function(){return this.toRgb().toHex()},t.prototype.toRgb=function(){function t(e,t,r){return 0>r&&r++,r>1&&r--,1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+(t-e)*(2/3-r)*6:e}var r,n,i,a=e.get("RGB");if(0===this.saturation)r=n=i=this.lightness;else{var s=this.lightness<.5?this.lightness*(1+this.saturation):this.lightness+this.saturation-this.lightness*this.saturation,o=2*this.lightness-s;r=t(o,s,this.hue+1/3),n=t(o,s,this.hue),i=t(o,s,this.hue-1/3)}return new a(Math.round(255*r),Math.round(255*n),Math.round(255*i))},Object.defineProperty(t.prototype,"hue",{get:function(){return this._hue},set:function(e){if(!("number"==typeof e&&e>=0&&1>=e))throw new Error("Hue must be a float between 0 and 1.");this._hue=e}}),Object.defineProperty(t.prototype,"lightness",{get:function(){return this._lightness},set:function(e){if(!("number"==typeof e&&e>=0&&1>=e))throw new Error("Lightness must be a float between 0 and 1.");this._lightness=e}}),Object.defineProperty(t.prototype,"saturation",{get:function(){return this._saturation},set:function(e){if(!("number"==typeof e&&e>=0&&1>=e))throw new Error("Saturation must be a float between 0 and 1.");this._saturation=e}}),t}]),angular.module("color").service("RGB",["$injector",function(e){function t(e,t,r){"object"==typeof e?(this.blue=e.blue,this.green=e.green,this.red=e.red):(this.blue=r,this.green=t,this.red=e)}return t.prototype.constructor=t,t.prototype.toHsl=function(){var t,r,n=this.red/255,i=this.green/255,a=this.blue/255,s=Math.max(n,i,a),o=Math.min(n,i,a),l=(s+o)/2,h=e.get("HSL");if(s===o)t=r=0;else{var p=s-o;switch(r=l>.5?p/(2-s-o):p/(s+o),s){case n:t=(i-a)/p+(a>i?6:0);break;case i:t=(a-n)/p+2;break;case a:t=(n-i)/p+4}t/=6}return new h(t,r,l)},t.prototype.toHex=function(){var t=e.get("HEX");return new t("#"+((1<<24)+(this.red<<16)+(this.green<<8)+this.blue).toString(16).slice(1))},t.prototype.luminosity=function(e,t,r){function n(e){var t=e/255;return.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4)}return"undefined"==typeof e&&(e=this.red,t=this.green,r=this.blue),.2126*n(e)+.7152*n(t)+.0722*n(r)},t.prototype.contrast=function(e){var t=this.luminosity(this.red,this.green,this.blue),r=this.luminosity(e.red,e.green,e.blue);return t>r?(t+.05)/(r+.05):(r+.05)/(t+.05)},Object.defineProperty(t.prototype,"blue",{get:function(){return this._blue},set:function(e){if(!(Number(e)===e&&e%1===0&&e>=0&&255>=e))throw new Error("Blue must be an integer between 0 and 255.");this._blue=e}}),Object.defineProperty(t.prototype,"green",{get:function(){return this._green},set:function(e){if(!(Number(e)===e&&e%1===0&&e>=0&&255>=e))throw new Error("Green must be an integer between 0 and 255.");this._green=e}}),Object.defineProperty(t.prototype,"red",{get:function(){return this._red},set:function(e){if(!(Number(e)===e&&e%1===0&&e>=0&&255>=e))throw new Error("Red must be an integer between 0 and 255.");this._red=e}}),t}]),angular.module("d3Colors",["color"]).factory("D3Colors",["d3","HEX","HSL","RGB",function(e,t,r,n){function i(e){this._colors=[],this.colors=e}return i.prototype.constructor=i,i.prototype.getScaledFadedColors=function(t){for(var r=[],n=0,i=this.colors.length;i>n;n++){var a=this.colors[n].toHsl(),s=a.brighten(t-1,!0);s.unshift(a);for(var o=0;t>o;o++)s[o]=s[o].toHex().toString();r=r.concat(s)}return e.scale.ordinal().domain(e.range(this.colors.length*(t+1))).range(r)},Object.defineProperty(i.prototype,"colors",{get:function(){return this._colors},set:function(e){if(!e||!e.length)throw new Error("Colors needs to be an array.");try{for(var r=0,n=e.length;n>r;r++)this._colors.push(new t(e[r]))}catch(i){throw new Error("Colors needs to be an array.")}}}),i}]);var GlobalEvents=function(){function e(e,r,n){t.eventStack={},this._=n}var t={};return e.prototype.off=function(e,r){return e in t.eventStack&&r in t.eventStack[e]?(t.eventStack[e].splice(r,1),!0):!1},e.prototype.on=function(e,r){return e in t.eventStack?t.eventStack[e].push(r):t.eventStack[e]=[r],t.eventStack[e].length-1},e.prototype.trigger=function(e){if(e in t.eventStack)for(var r=t.eventStack[e],n=0,i=r.length;i>n;n++)this._.isFunction(r[n])&&r[n]()},e}();angular.module("globalEvents").service("globalEvents",["$window","$","_",GlobalEvents]),angular.module("neo4jD3").factory("Neo4J",["$resource","$window",Neo4J]),Neo4jD3.prototype.get=function(){if(this.d3&&"function"==typeof this.d3.value)return this.d3;var e=this.$q.defer();this.Neo4J.query({statements:[{statement:"MATCH (parent:cl:Class)<-[:`rdfs:subClassOf`]-(child) OPTIONAL MATCH (dataSet:DataSet)-[:`annotated_with`]->(child) RETURN parent, child, dataSet"}]}).$promise.then(function(t){if(0===t.errors.length)try{var r=(new Date).getTime(),n=buildTree(t.results[0]);e.resolve(n);var i=(new Date).getTime(),a=i-r;console.log("Neo4J to D3 converter execution time: "+a)}catch(s){e.reject(s),console.error(s)}this.neo4jResponse=t}.bind(this))["catch"](function(t){e.reject(t),console.error(t)}),this.d3=e.promise},Object.defineProperty(Neo4jD3.prototype,"neo4jResponse",{configurable:!1,enumerable:!0,writable:!0}),Object.defineProperty(Neo4jD3.prototype,"d3",{configurable:!1,enumerable:!0,writable:!0}),angular.module("neo4jD3").service("neo4jD3",["$q","Neo4J","settings",Neo4jD3]);
//# sourceMappingURL=app.js.map